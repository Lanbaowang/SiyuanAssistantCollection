## 功能

这是一个实用功能和AI助手几何插件（SiyuanAssistantCollection），不是Stand Alone Complex的意思。

主要是一些实用小工功能，还有一些AI助手的界面对接。

## 组成

### 向量数据生成、存储和查询

#### 数据结构

由于部分属性其实并不适合放到思源的数据库里面(因为所有的自定义属性都会被渲染到DOM中),所以我们重新创建了一个新的键值对存储.

对于思源中所有有ID的对象,都可以通过这个KV存储来扩展它们的属性内容.

#### 数据同步

数据同步计划使用websocket,当任意一个前端网页发生数据更新时,它会做这几件事:

1.通过websocket广播提醒各个端更新本地数据库实例.

2.将新的数据库拷贝落盘存储

#### 性能优化

为了达到比较好的性能,所有的数据将会按照ID对8取模的值,存储在一个json文件中.

当对应的ID被查询时,将会以K近邻检索查询最近的1000个ID并将它们也载入到内存,检索向量来自embedding,


#### 服务端与客户端

这个简易向量数据库没有服务端，使用的是思源的文件接口。

#### 模型选择

目前实验下使用shibing624/text2vec-base-chinese的效果和性能比较合适.

为了能够更方便在web端使用,做了一个量化版本.

### 实时分词菜单和分词tips生成

在输入的同时计算可用的参考资料和功能,采用了多重防抖以及AbortController保证内容生成性能,目前的测试是在28万个内容块的时候基本可用.(i5 10400,32g).

之后还会继续优化这里地性能表现,实时菜单和实时参考是AI辅助的基础.

### 计算方法

通过用户自定义的动作生成表生成菜单,生成性能较低的菜单项在用户快速输入时会被阻断.

所以能够使用相对更多一点的菜单项目.

### 动作列表示例

位于installed/actionList文件夹,你可以尝试编写自己的动作表


## 协议

使用的外部依赖请参考他们各自的协议,暂时没有时间列出.
除此之外使用AGPL-3.0-or-later,有关协议内容参考官网和本文件夹下的license文件.


## 感谢

向量嵌入部分使用了transformers.js库

向量嵌入部分使用了shibing624的text2vec-base-chinese模型

分词依赖jieba与pinyin

## 其他

有关椽承设计:我们其实是做装修设计的(额,建筑规划景观园林其实也做),不信可以看我们的小红书和知乎,要是有人要做室内设计可以联系我们啊~~~

另外如果觉得这玩意有用可以请我们喝杯咖啡

![支付宝]('./支付宝收款码1.jpg')

![微信]('./微信收款码1.jpg')