/* esm.sh - esbuild bundle(mingo@6.4.10) es2022 production */
var rr=Object.defineProperty;var vt=(e,t)=>{for(var r in t)rr(e,r,{get:t[r],enumerable:!0})};var Ht=Number.MAX_SAFE_INTEGER,Xt=Number.MIN_SAFE_INTEGER,X=Symbol("missing"),he=Object.freeze(new Error("mingo: cycle detected while processing object/array")),or=Object.getPrototypeOf([]),ge=Object.getPrototypeOf({}),nr="[object Object]",sr=/^\[object ([a-zA-Z0-9]+)\]$/,mt=class{},ft=class{},J=e=>e===null?mt:e===void 0?ft:e.constructor,_t=e=>{let t=cr(e),r=0,o=t.length;for(;o;)r=(r<<5)-r^t.charCodeAt(--o);return r>>>0},xe=new Set(["null","undefined","boolean","number","string","date","regexp"]),me=new Set([ft,mt,Boolean,String,Number]),ct=e=>e.toString(),F=e=>`${J(e).name}[${e.toString()}]`,Z=new Map([[Number,ct],[Boolean,ct],[RegExp,ct],[Function,ct],[Symbol,ct],[Date,e=>e.toISOString()],[String,JSON.stringify],[mt,e=>"null"],[ft,e=>"undefined"],[Int8Array,F],[Uint8Array,F],[Uint8ClampedArray,F],[Int16Array,F],[Uint16Array,F],[Int32Array,F],[Uint32Array,F],[Float32Array,F],[Float64Array,F]]);typeof BigInt<"u"&&Z.set(BigInt,e=>"0x"+e.toString(16));typeof BigInt64Array<"u"&&Z.set(BigInt64Array,F);typeof BigUint64Array<"u"&&Z.set(BigUint64Array,F);var ir={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},w=(e,t)=>{e===X&&(e=void 0),t===X&&(t=void 0);let[r,o]=[e,t].map(n=>ir[G(n).toLowerCase()]);return r!==o?r-o:r===1||r===2||r===6?e<t?-1:e>t?1:0:R(e,t)?0:e<t?-1:e>t?1:0};function l(e,t){if(!e)throw new Error(t)}var ur=e=>{let t=Object.getPrototypeOf(J(e));return t&&t.name==="TypedArray"},wt=e=>{if(me.has(J(e)))return e;let t=new Set,r=o=>{if(t.has(o))throw he;let n=J(o);if(me.has(n))return o;try{if(p(o))return t.add(o),o.map(r);if(g(o)){t.add(o);let s={};for(let a in o)s[a]=r(o[a]);return s}}finally{t.delete(o)}return n===Date||n===RegExp||ur(o)?new n(o):o};return r(e)},G=e=>sr.exec(Object.prototype.toString.call(e))[1],pt=e=>typeof e=="boolean",y=e=>typeof e=="string";var d=e=>!isNaN(e)&&typeof e=="number";var p=Array.isArray,g=e=>{if(!e)return!1;let t=Object.getPrototypeOf(e);return(t===ge||t===null)&&nr===Object.prototype.toString.call(e)},dt=e=>e===Object(e),ht=e=>e instanceof Date,gt=e=>e instanceof RegExp,tt=e=>typeof e=="function",c=e=>e==null,B=(e,t)=>e.includes(t),Tt=(e,t)=>!B(e,t),M=(e,t=!0)=>!!e||t&&e==="",k=e=>c(e)||y(e)&&!e||e instanceof Array&&e.length===0||g(e)&&Object.keys(e).length===0,fe=e=>e===X,z=e=>e instanceof Array?e:[e],S=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),ar=(e,t)=>g(e)&&g(t)||p(e)&&p(t);function Nt(e,t,r){if(r=r||{flatten:!1},fe(e)||c(e))return t;if(fe(t)||c(t))return e;if(!ar(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,p(e)){let o=e,n=t;if(r.flatten){let s=0,a=0;for(;s<o.length&&a<n.length;)o[s]=Nt(o[s++],n[a++],r);for(;a<n.length;)o.push(t[a++])}else L(o,n)}else for(let o in t)e[o]=Nt(e[o],t[o],r);return e}function pe(e,t=_t){let r=new Map;return e.forEach((o,n)=>{let s=Mt(o,t);r.has(s)?r.get(s).some(a=>R(e[a],o))||r.get(s).push(n):r.set(s,[n])}),r}function et(e,t=_t){if(e.some(u=>u.length==0))return[];if(e.length===1)return Array.from(e);let r=$e(e.map((u,m)=>[m,u.length]),u=>u[1]),o=e[r[0][0]],n=pe(o,t),s=new Map,a=new Array;return n.forEach((u,m)=>{let f=u.map($=>o[$]),x=f.map($=>0),b=f.map($=>[r[0][0],0]),W=!1;for(let $=1;$<e.length;$++){let[E,T]=r[$],ot=e[E];if(s.has($)||s.set($,pe(ot)),s.get($).has(m)){let Q=s.get($).get(m).map(at=>ot[at]);W=f.map((at,lt)=>Q.some((Ze,tr)=>{let er=x[lt];return R(at,Ze)&&(x[lt]++,E<b[lt][0]&&(b[lt]=[E,s.get($).get(m)[tr]])),er<x[lt]})).some(Boolean)}if(!W)return}W&&L(a,x.map(($,E)=>$===e.length-1?[f[E],b[E]]:X).filter($=>$!==X))}),a.sort((u,m)=>{let[f,[x,b]]=u,[W,[$,E]]=m,T=w(x,$);return T!==0?T:w(b,E)}).map(u=>u[0])}function Jt(e,t=0){let r=new Array;function o(n,s){for(let a=0,u=n.length;a<u;a++)p(n[a])&&(s>0||s<0)?o(n[a],Math.max(-1,s-1)):r.push(n[a])}return o(e,t),r}var lr=e=>{let[t,r]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],o=t;for(;!r.length&&t!==ge&&t!==or;)o=t,r=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);let n={};return r.forEach(s=>n[s]=e[s]),[n,o]};function R(e,t){let r=[[e,t]];for(;r.length>0;){if([e,t]=r.pop(),e===t)continue;let o=J(e);if(o!==J(t)||tt(e))return!1;if(Z.has(o)){let n=Z.get(o);if(n(e)!==n(t))return!1;continue}if(o===Array||o===Object){let n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length||new Set(n.concat(s)).size!=n.length)return!1;for(let a of n)r.push([e[a],t[a]]);continue}return!1}return!r.length}function cr(e){let t=new Set,r=o=>{let n=J(o);if(Z.has(n))return Z.get(n)(o);let s=n===Object?"":n.name;if(tt(o.toJSON))return`${s}(${JSON.stringify(o)})`;if(t.has(o))throw he;t.add(o);try{if(n===Array)return"["+o.map(r).join(",")+"]";if(n!==Object){let[u,m]=lr(o);if(p(o))return`${s}${r([...o,u])}`;o=u}let a=Object.keys(o);return a.sort(),`${s}{`+a.map(u=>`${u}:${r(o[u])}`).join(",")+"}"}finally{t.delete(o)}};return r(e)}function Mt(e,t){return t=t||_t,c(e)?null:t(e).toString()}function $e(e,t,r=w){if(k(e))return e;let o=new Array,n=new Array;for(let s=0;s<e.length;s++){let a=e[s],u=t(a,s);c(u)?n.push(a):o.push([u,a])}return o.sort((s,a)=>r(s[0],a[0])),L(n,o.map(s=>s[1]))}function It(e,t,r=_t){if(e.length<1)return new Map;let o=new Map,n=new Map;for(let s=0;s<e.length;s++){let a=e[s],u=t(a,s),m=Mt(u,r);if(m===null)n.has(null)?n.get(null).push(a):n.set(null,[a]);else{let f=o.has(m)?o.get(m).find(x=>R(x,u)):null;c(f)?(n.set(u,[a]),o.has(m)?o.get(m).push(u):o.set(m,[u])):n.get(f).push(a)}}return n}var Gt=5e4;function L(e,...t){return e instanceof Array?t.reduce((r,o)=>{let n=Math.ceil(o.length/Gt),s=0;for(;n-- >0;)Array.prototype.push.apply(r,o.slice(s,s+Gt)),s+=Gt;return r},e):t.filter(dt).reduce((r,o)=>(Object.assign(r,o),r),e)}function Kt(e,t){return dt(e)?e[t]:void 0}function mr(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function D(e,t,r){let o=0;function n(a,u){let m=a;for(let f=0;f<u.length;f++){let x=u[f];if(/^\d+$/.exec(x)===null&&m instanceof Array){if(f===0&&o>0)break;o+=1;let W=u.slice(f);m=m.reduce(($,E)=>{let T=n(E,W);return T!==void 0&&$.push(T),$},[]);break}else m=Kt(m,x);if(m===void 0)break}return m}let s=xe.has(G(e).toLowerCase())?e:n(e,t.split("."));return s instanceof Array&&r?.unwrapArray?mr(s,o):s}function nt(e,t,r){let o=t.split("."),n=o[0],s=o.slice(1).join("."),a=/^\d+$/.exec(n)!==null,u=o.length>1,m,f;if(e instanceof Array)if(a)m=Kt(e,Number(n)),u&&(m=nt(m,s,r)),m=[m];else{m=[];for(let x of e)f=nt(x,t,r),r?.preserveMissing?(f===void 0&&(f=X),m.push(f)):f!==void 0&&m.push(f)}else{if(f=Kt(e,n),u&&(f=nt(f,s,r)),f===void 0)return;m=r?.preserveKeys?Object.assign({},e):{},m[n]=f}return m}function Et(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===X?e.splice(t,1):Et(e[t]);else if(g(e))for(let t in e)S(e,t)&&Et(e[t])}var de=/^\d+$/;function At(e,t,r,o){let n=t.split("."),s=n[0],a=n.slice(1).join(".");if(n.length===1)(g(e)||p(e)&&de.test(s))&&r(e,s);else{o?.buildGraph&&c(e[s])&&(e[s]={});let u=e[s];if(!u)return;let m=!!(n.length>1&&de.test(n[1]));u instanceof Array&&o?.descendArray&&!m?u.forEach(f=>At(f,a,r,o)):At(u,a,r,o)}}function St(e,t,r){At(e,t,(o,n)=>{o[n]=tt(r)?r(o[n]):r},{buildGraph:!0})}function xt(e,t,r){At(e,t,(o,n)=>{if(o instanceof Array){if(/^\d+$/.test(n))o.splice(parseInt(n),1);else if(r&&r.descendArray)for(let s of o)g(s)&&delete s[n]}else g(o)&&delete o[n]},r)}var fr=/^\$[a-zA-Z0-9_]+$/;function P(e){return fr.test(e)}function Ct(e){if(xe.has(G(e).toLowerCase()))return gt(e)?{$regex:e}:{$eq:e};if(dt(e)){if(!Object.keys(e).some(P))return{$eq:e};if(S(e,"$regex")){let r=Object.assign({},e);return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var Y;(function(e){e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF"})(Y||(Y={}));var N=class e{constructor(t,r,o,n=Date.now()){this._opts=t,this._root=r,this._local=o,this.timestamp=n,this.update(r,o)}static init(t,r,o){return t instanceof e?new e(t._opts,c(t.root)?r:t.root,Object.assign({},t.local,o)):new e(t,r,o)}update(t,r){var o;return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},(o=this._local)===null||o===void 0?void 0:o.variables,r?.variables)}),this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:K.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collation}get processingMode(){var t;return((t=this._opts)===null||t===void 0?void 0:t.processingMode)||Y.CLONE_OFF}get useStrictMode(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useStrictMode}get scriptEnabled(){var t;return(t=this._opts)===null||t===void 0?void 0:t.scriptEnabled}get useGlobalContext(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useGlobalContext}get hashFunction(){var t;return(t=this._opts)===null||t===void 0?void 0:t.hashFunction}get collectionResolver(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collectionResolver}get jsonSchemaValidator(){var t;return(t=this._opts)===null||t===void 0?void 0:t.jsonSchemaValidator}get variables(){var t;return(t=this._opts)===null||t===void 0?void 0:t.variables}get context(){var t;return(t=this._opts)===null||t===void 0?void 0:t.context}};function st(e){return e instanceof N?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:Y.CLONE_OFF},e),{context:e?.context?K.from(e?.context):K.init({})}))}var h;(function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window"})(h||(h={}));var K=class e{constructor(t){this.operators={[h.ACCUMULATOR]:{},[h.EXPRESSION]:{},[h.PIPELINE]:{},[h.PROJECTION]:{},[h.QUERY]:{},[h.WINDOW]:{}};for(let[r,o]of Object.entries(t))this.addOperators(r,o)}static init(t={}){return new e(t)}static from(t){return new e(t.operators)}addOperators(t,r){for(let[o,n]of Object.entries(r))this.getOperator(t,o)||(this.operators[t][o]=n);return this}addAccumulatorOps(t){return this.addOperators(h.ACCUMULATOR,t)}addExpressionOps(t){return this.addOperators(h.EXPRESSION,t)}addQueryOps(t){return this.addOperators(h.QUERY,t)}addPipelineOps(t){return this.addOperators(h.PIPELINE,t)}addProjectionOps(t){return this.addOperators(h.PROJECTION,t)}addWindowOps(t){return this.addOperators(h.WINDOW,t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}},rt=K.init();function $t(e,t){for(let[r,o]of Object.entries(t)){l(tt(o)&&P(r),`'${r}' is not a valid operator`);let n=j(e,r,null);l(!n||o===n,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case h.ACCUMULATOR:rt.addAccumulatorOps(t);break;case h.EXPRESSION:rt.addExpressionOps(t);break;case h.PIPELINE:rt.addPipelineOps(t);break;case h.PROJECTION:rt.addProjectionOps(t);break;case h.QUERY:rt.addQueryOps(t);break;case h.WINDOW:rt.addWindowOps(t);break}}function j(e,t,r){let{context:o,useGlobalContext:n}=r||{},s=o?o.getOperator(e,t):null;return!s&&n?rt.getOperator(e,t):s}var ye={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},Zt={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!S(t,"$cond"))return e;let o;for(let[n,s]of Object.entries(e))if(dt(s)){if(s instanceof Array){let a=[];for(let u of s)g(u)&&(u=te(u,t,r.update(u))),c(u)||a.push(u);o=a}else o=te(s,t,r.update(s));c(o)?delete e[n]:e[n]=o}return e}};function i(e,t,r,o){var n;let s=N.init(o,e);if(r=r||"",P(r)){let a=j(h.EXPRESSION,r,o);if(a)return a(e,t,s);let u=j(h.ACCUMULATOR,r,o);if(u)return e instanceof Array||(e=i(e,t,null,s),t=null),l(e instanceof Array,`'${r}' target must be an array.`),u(e,t,s.update(null,s.local));throw new Error(`operator '${r}' is not registered`)}if(y(t)&&t.length>0&&t[0]==="$"){if(S(Zt,t))return t;let a=s.root,u=t.split(".");if(S(ye,u[0]))a=ye[u[0]](e,null,s),t=t.slice(u[0].length+1);else if(u[0].slice(0,2)==="$$"){a=Object.assign({},s.variables,{this:e},(n=s.local)===null||n===void 0?void 0:n.variables);let m=u[0].slice(2);l(S(a,m),`Use of undefined variable: ${m}`),t=t.slice(2)}else t=t.slice(1);return t===""?a:D(a,t)}if(p(t))return t.map(a=>i(e,a,null,s));if(g(t)){let a={};for(let[u,m]of Object.entries(t))if(a[u]=i(e,m,u,s),[h.EXPRESSION,h.ACCUMULATOR].some(f=>!!j(f,u,o)))return l(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),a[u];return a}return t}function te(e,t,r){let o=i(e,t,null,r);return S(Zt,o)?Zt[o](e,t,r):o}var Vt={};vt(Vt,{$and:()=>pr,$not:()=>dr,$or:()=>hr});var pr=(e,t,r)=>{let o=i(e,t,null,r);return M(o,r.useStrictMode)&&o.every(n=>M(n,r.useStrictMode))};var dr=(e,t,r)=>{let o=z(t);if(o.length==0)return!1;if(o.length==1)return!i(e,o[0],null,r);throw"Expression $not takes exactly 1 argument"};var hr=(e,t,r)=>{let o=i(e,t,null,r),n=r.useStrictMode;return M(o,n)&&o.some(s=>M(s,n))};var zt={};vt(zt,{$cmp:()=>gr,$eq:()=>vr,$gt:()=>Nr,$gte:()=>Er,$lt:()=>Ar,$lte:()=>_r,$ne:()=>wr});var gr=(e,t,r)=>{let o=i(e,t,null,r);return o[0]>o[1]?1:o[0]<o[1]?-1:0};function U(e){return e instanceof yt?e:new yt(e)}function kt(...e){let t=0;return U(()=>{for(;t<e.length;){let r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function xr(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function $r(e,t){let r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}var ee=new Error,q;(function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"})(q||(q={}));function yr(e,t,r){let o=!1,n=-1,s=0;return function(a){try{t:for(;!o;){let u=e();n++;let m=-1,f=t.length,x=!1;for(;++m<f;){let b=t[m];switch(b.action){case q.MAP:u=b.func(u,n);break;case q.FILTER:if(!b.func(u,n))continue t;break;case q.TAKE:--b.count,b.count||(x=!0);break;case q.DROP:--b.count,b.count||$r(t,m);continue t;default:break t}}if(o=x,a)r[s++]=u;else return{value:u,done:!1}}}catch(u){if(u!==ee)throw u}return o=!0,{done:o}}}var yt=class{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),xr(t)){let o=t;r=()=>{let n=o.next();if(n.done)throw ee;return n.value}}else if(t instanceof Array){let o=t,n=o.length,s=0;r=()=>{if(s<n)return o[s++];throw ee}}else if(!(t instanceof Function))throw new Error("Lazy must be initialized with an array, generator, or function.");this.getNext=yr(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(q.MAP,t)}filter(t){return this.push(q.FILTER,t)}take(t){return t>0?this.push(q.TAKE,t):this}drop(t){return t>0?this.push(q.DROP,t):this}transform(t){let r=this,o;return U(()=>(o||(o=U(t(r.value()))),o.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){let r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let o=this.next();for(r===void 0&&!o.done&&(r=o.value,o=this.next());!o.done;)r=t(r,o.value),o=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};var C=class{constructor(t,r){this.pipeline=t,this.options=st(r)}stream(t){let r=U(t),o=this.options.processingMode;(o==Y.CLONE_ALL||o==Y.CLONE_INPUT)&&r.map(wt);let n=new Array;if(!k(this.pipeline))for(let s of this.pipeline){let a=Object.keys(s),u=a[0],m=j(h.PIPELINE,u,this.options);l(a.length===1&&!!m,`invalid pipeline operator ${u}`),n.push(u),r=m(r,s[u],this.options)}return(o==Y.CLONE_OUTPUT||o==Y.CLONE_ALL&&et([["$group","$unwind"],n]).length)&&r.map(wt),r}run(t){return this.stream(t).value()}};var Dt=class{constructor(t,r,o,n){this.source=t,this.predicate=r,this.projection=o,this.options=n,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(g(this.projection)&&this.operators.push({$project:this.projection}),this.result=U(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new C(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){let t=U([...this.buffer]);return this.buffer=[],kt(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options=Object.assign(Object.assign({},this.options),{collation:t}),this}next(){if(this.buffer.length>0)return this.buffer.pop();let t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;let t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}};var A=class{constructor(t,r){this.condition=t,this.options=st(r),this.compiled=[],this.compile()}compile(){l(g(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);let t={};for(let[r,o]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:o});else if(B(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,o);else{l(!P(r),`unknown top level operator: ${r}`);for(let[n,s]of Object.entries(Ct(o)))this.processOperator(r,n,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,o){let n=j(h.QUERY,r,this.options);if(!n)throw new Error(`unknown operator ${r}`);let s=n(t,o,this.options);this.compiled.push(s)}test(t){for(let r=0,o=this.compiled.length;r<o;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new Dt(t,o=>this.test(o),r||{},this.options)}remove(t){return t.reduce((r,o)=>(this.test(o)||r.push(o),r),[])}};function O(e){let t=(r,o,n)=>{let s={unwrapArray:!0},a=Math.max(1,r.split(".").length-1);return u=>{let m=D(u,r,s);return e(m,o,Object.assign(Object.assign({},n),{depth:a}))}};return t.op="query",t}function V(e){return(t,r,o)=>{let n=i(t,r,null,o);return e(...n)}}function Ot(e,t,r){if(R(e,t)||c(e)&&c(t))return!0;if(e instanceof Array){let o=R.bind(null,t);return e.some(o)||Jt(e,r?.depth).some(o)}return!1}function Ut(e,t,r){return!Ot(e,t,r)}function ne(e,t,r){return c(e)?t.some(o=>o===null):et([z(e),t],r?.hashFunction).length>0}function Rt(e,t,r){return!ne(e,t,r)}function Lt(e,t,r){return Bt(e,t,(o,n)=>w(o,n)<0)}function Ft(e,t,r){return Bt(e,t,(o,n)=>w(o,n)<=0)}function Pt(e,t,r){return Bt(e,t,(o,n)=>w(o,n)>0)}function jt(e,t,r){return Bt(e,t,(o,n)=>w(o,n)>=0)}function Ee(e,t,r){return z(e).some(o=>t.length===2&&o%t[0]===t[1])}function Ae(e,t,r){let o=z(e),n=s=>y(s)&&M(t.exec(s),r?.useStrictMode);return o.some(n)||Jt(o,1).some(n)}function _e(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function we(e,t,r){if(!p(e)||!p(t)||!e.length||!t.length)return!1;let o=!0;for(let n of t){if(!o)break;g(n)&&B(Object.keys(n),"$elemMatch")?o=se(e,n.$elemMatch,r):n instanceof RegExp?o=e.some(s=>typeof s=="string"&&n.test(s)):o=e.some(s=>R(n,s))}return o}function Te(e,t,r){return Array.isArray(e)&&e.length===t}function Or(e){return P(e)&&["$and","$or","$nor"].indexOf(e)===-1}function se(e,t,r){if(p(e)&&!k(e)){let o=a=>a,n=t;Object.keys(t).every(Or)&&(n={temp:t},o=a=>({temp:a}));let s=new A(n,r);for(let a=0,u=e.length;a<u;a++)if(s.test(o(e[a])))return!0}return!1}var Oe=e=>e===null,be=e=>d(e)&&e>=-2147483648&&e<=2147483647&&e.toString().indexOf(".")===-1,ve=e=>d(e)&&e>=Xt&&e<=Ht&&e.toString().indexOf(".")===-1,br={array:p,bool:pt,boolean:pt,date:ht,decimal:d,double:d,int:be,long:ve,number:d,null:Oe,object:g,regex:gt,regexp:gt,string:y,undefined:c,function:e=>{throw new Error("unsupported type key `function`.")},1:d,2:y,3:g,4:p,6:c,8:pt,9:ht,10:Oe,11:gt,16:be,18:ve,19:d};function Ne(e,t,r){let o=br[t];return o?o(e):!1}function Me(e,t,r){return Array.isArray(t)?t.findIndex(o=>Ne(e,o,r))>=0:Ne(e,t,r)}function Bt(e,t,r){return z(e).some(o=>G(o)===G(t)&&r(o,t))}var vr=V(Ot);var Nr=V(Pt);var Er=V(jt);var Ar=V(Lt);var _r=V(Ft);var wr=V(Ut);var it=1e3*60*60*24,Se={week:it*7,day:it,hour:1e3*60*60,minute:1e3*60,second:1e3,millisecond:1};var Fi={week:it*7,day:it,hour:it/24,minute:6e4,second:1e3,millisecond:1};var bt=(e,t,r)=>{if(k(t)||!g(t))return e;let o=w,n=r.collation;return g(n)&&y(n.locale)&&(o=Rr(n)),e.transform(s=>{let a=Object.keys(t);for(let u of a.reverse()){let m=It(s,x=>D(x,u),r.hashFunction),f=Array.from(m.keys()).sort(o);t[u]===-1&&f.reverse(),s=[],f.reduce((x,b)=>L(x,m.get(b)),s)}return s})},Ur={1:"base",2:"accent",3:"variant"};function Rr(e){let t={sensitivity:Ur[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));let r=new Intl.Collator(e.locale,t);return(o,n)=>{if(!y(o)||!y(n))return w(o,n);let s=r.compare(o,n);return s<0?-1:s>0?1:0}}var ue=(e,t,r)=>e.take(t);var Yl=V(Rt);var Ve=(e,t,r)=>{let o=i(e,t,null,r),n=o[0],s=o[1],a=o[2];return c(a)?s<0?(s=Math.max(0,n.length+s),a=n.length-s+1):(a=s,s=0):(s<0&&(s=Math.max(0,n.length+s)),l(a>0,"Invalid argument for $slice operator. Limit must be a positive number"),a+=s),n.slice(s,a)};var ut=(e,t)=>(r,o,n)=>{l(p(o),`${e}: expression must be an array.`);let s=i(r,o,null,n);return s.some(c)?null:(l(s.every(d),`${e}: expression must evalue to array of numbers.`),t(s))};var Pc=ut("$bitAnd",e=>e.reduce((t,r)=>t&r,-1));var Wc=ut("$bitOr",e=>e.reduce((t,r)=>t|r,0));var Kc=ut("$bitXor",e=>e.reduce((t,r)=>t^r,0));var ke=(e,t)=>{let r={};return e.split("").forEach((o,n)=>r[o]=t*(n+1)),r},wm=Object.assign(Object.assign(Object.assign({},ke("ABCDEFGHIKLM",1)),ke("NOPQRSTUVWXY",-1)),{Z:0});var Le={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function v(e,t=Le){let r=Object.assign({},Le,t),o=new Set(Object.keys(r));return(n,s,a)=>{let u=i(n,s,null,a);if(o.has(`${u}`)){let m=r[`${u}`];if(m instanceof Error)throw new Error(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return m}return e(u)}}var Sh=v(Math.acos,{Infinity:1/0,0:new Error});var kh=v(Math.acosh,{Infinity:1/0,0:new Error});var Rh=v(Math.asin);var Ph=v(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});var zh=v(Math.atan);var Kh=v(Math.atanh,{1:1/0,"-1":-1/0});var Jh=v(Math.cos);var eg=v(Math.cosh,{"-Infinity":1/0,Infinity:1/0});var Yr=Math.PI/180,ng=v(e=>e*Yr,{Infinity:1/0,"-Infinity":1/0});var qr=180/Math.PI,ug=v(e=>e*qr,{Infinity:1/0,"-Infinity":-1/0});var cg=v(Math.sin);var pg=v(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});var gg=v(Math.tan);var qt=(e,t,r)=>{if(k(t))return e;let o=Object.keys(t),n=!1;Pe(t,r);let s=r.idKey;if(B(o,s)){let u=t[s];(u===0||u===!1)&&(o=o.filter(Tt.bind(null,[s])),n=o.length==0)}else o.push(s);let a=N.init(r);return e.map(u=>ae(u,t,a.update(u),o,n))};function ae(e,t,r,o,n){let s={},a=!1,u=!1,m=[];n&&m.push(r.idKey);for(let f of o){let x,b=t[f];if(f!==r.idKey&&B([0,!1],b)&&(u=!0),f===r.idKey&&k(b))x=e[f];else if(y(b))x=i(e,b,f,r);else if(!B([1,!0],b))if(b instanceof Array)x=b.map($=>{let E=i(e,$,null,r);return c(E)?null:E});else if(g(b)){let $=b,E=Object.keys(b),T=E.length==1?E[0]:"",ot=j(h.PROJECTION,T,r);if(ot)T==="$slice"?z($[T]).every(d)?(x=ot(e,$[T],f,r),a=!0):x=i(e,$,f,r):x=ot(e,$[T],f,r);else if(P(T))x=i(e,$[T],T,r);else if(S(e,f)){Pe($,r);let Q=e[f];Q instanceof Array?x=Q.map(at=>ae(at,$,r,E,!1)):(Q=g(Q)?Q:e,x=ae(Q,$,r,E,!1))}else x=i(e,b,null,r)}else{m.push(f);continue}let W=nt(e,f,{preserveMissing:!0});W!==void 0&&Nt(s,W,{flatten:!0}),Tt([0,1,!1,!0],b)&&(x===void 0?xt(s,f,{descendArray:!0}):St(s,f,x))}if(Et(s),(a||u||n)&&(s=L({},e,s),m.length>0))for(let f of m)xt(s,f,{descendArray:!0});return s}function Pe(e,t){let r=[!1,!1];for(let[o,n]of Object.entries(e)){if(o===t?.idKey)return;n===0||n===!1?r[0]=!0:(n===1||n===!0)&&(r[1]=!0),l(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}var le=(e,t,r)=>e.drop(t);var Wt={};vt(Wt,{$elemMatch:()=>Gr,$slice:()=>Kr});var Gr=(e,t,r,o)=>{let n=D(e,r),s=new A(t,o);l(n instanceof Array,"$elemMatch: argument must resolve to array");let a=[];for(let u=0;u<n.length;u++)if(s.test(n[u])){if(o.useStrictMode)return[n[u]];a.push(n[u])}return a.length>0?a:void 0};var Kr=(e,t,r,o)=>{let n=D(e,r),s=t;return p(n)?Ve(e,t instanceof Array?[n,...s]:[n,t],o):n};var Qt={};vt(Qt,{$all:()=>Hr,$and:()=>io,$bitsAllClear:()=>je,$bitsAllSet:()=>Be,$bitsAnyClear:()=>ze,$bitsAnySet:()=>Ye,$elemMatch:()=>Xr,$eq:()=>qe,$exists:()=>Zr,$expr:()=>eo,$gt:()=>We,$gte:()=>Qe,$in:()=>Ge,$jsonSchema:()=>ro,$lt:()=>Ke,$lte:()=>He,$mod:()=>oo,$ne:()=>Xe,$nin:()=>Je,$nor:()=>uo,$not:()=>ao,$or:()=>ce,$regex:()=>no,$size:()=>Jr,$type:()=>to,$where:()=>so});var Hr=O(we);var Xr=O(se);var Jr=O(Te);var H=e=>O((t,r,o)=>{let n=0;if(r instanceof Array)for(let s of r)n=n|1<<s;else n=r;return e(t&n,n)});var je=H((e,t)=>e==0);var Be=H((e,t)=>e==t);var ze=H((e,t)=>e<t);var Ye=H((e,t)=>e>0);var qe=O(Ot);var We=O(Pt);var Qe=O(jt);var Ge=O(ne);var Ke=O(Lt);var He=O(Ft);var Xe=O(Ut);var Je=O(Rt);var Zr=O(_e);var to=O(Me);function eo(e,t,r){return o=>i(o,t,null,r)}function ro(e,t,r){if(!r?.jsonSchemaValidator)throw new Error("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");let o=r?.jsonSchemaValidator(t);return n=>o(n)}var oo=O(Ee);var no=O(Ae);function so(e,t,r){l(r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");let o=t;return l(tt(o),"$where only accepts a Function object"),n=>M(o.call(n),r?.useStrictMode)}var io=(e,t,r)=>{l(p(t),"Invalid expression: $and expects value to be an Array.");let o=t.map(n=>new A(n,r));return n=>o.every(s=>s.test(n))};var ce=(e,t,r)=>{l(p(t),"Invalid expression. $or expects value to be an Array");let o=t.map(n=>new A(n,r));return n=>o.some(s=>s.test(n))};var uo=(e,t,r)=>{l(p(t),"Invalid expression. $nor expects value to be an array.");let o=ce("$or",t,r);return n=>!o(n)};var ao=(e,t,r)=>{let o={};o[e]=Ct(t);let n=new A(o,r);return s=>!n.test(s)};$t(h.EXPRESSION,Object.assign(Object.assign({},Vt),zt));$t(h.PIPELINE,{$project:qt,$skip:le,$limit:ue,$sort:bt});$t(h.PROJECTION,Wt);$t(h.QUERY,Qt);var mO=K.init().addExpressionOps(Object.assign(Object.assign({},Vt),zt)).addPipelineOps({$project:qt,$skip:le,$limit:ue,$sort:bt}).addProjectionOps(Wt).addQueryOps(Qt);function lo(e,t,r,o){return new A(t,o).find(e,r)}function co(e,t,r){return new A(t,r).remove(e)}function mo(e,t,r){return new C(t,r).run(e)}var gO={Aggregator:C,Query:A,aggregate:mo,find:lo,remove:co};export{C as Aggregator,A as Query,mo as aggregate,gO as default,lo as find,co as remove};
//# sourceMappingURL=mingo.bundle.mjs.map